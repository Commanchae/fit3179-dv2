{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "background":"#FCFFF7",
  "vconcat": [
    {
      "data": {
        "url": "australian-states-flow-by-year.csv",
        "name": "cleaned2"
      },
      "transform": [
        {
          "calculate": "(parseInt(datum.netflow)/datum.population)*10000",
          "as": "netflow"  
        },
        {
          "calculate": "datum.state == 'NSW' ? 'New South Wales ': datum.state == 'VIC' ? 'Victoria' : datum.state == 'QLD' ? 'Queensland': datum.state == 'WA' ? 'Western Australia' : datum.state == 'SA' ? 'South Australia' : datum.state == 'TAS' ? 'Tasmania' : datum.state == 'ACT' ?  'Australian Capital Territory' : 'Northern Territory'",
          "as": "statename"
        },
        {
          "filter": "datum.state != 'AUS'"
        },
        {"calculate": "'In ' + timeFormat(datum.year, '%Y') + ', ~'+ round(datum.netflow,2) + ' internationals (per 10,000 population) came into '  +  datum.statename + '.'", "as": "Insight"}
      ],
      "layer": [
        {
          "width": 500,
          "height": 200,
          "title": {
            "text": "Netflow of International Migrants by State",
            "subtitle": "Net Flow of Migrants (per 10,000 population)",
            "color":"#286d86",
            "subtitleColor":"#698691"
          },
          "selection": {
            "state_highlight": {
              "type": "multi",
              "fields": [
                "state"
              ],
              "bind": "legend"
            }
          },
          "mark": "line",
          "encoding": {
            "x": {
              "field": "year",
              "type": "temporal",
              "axis": {
                "labelColor": "#286d86"
              }
            },
            "y": {
              "field": "netflow",
              "type": "quantitative",
              "axis": {
    "titleX": -60,
  "titleColor": "#286d86",
  "labelColor": "#286d86"}
            },
            "color": {
              "field": "state",
              "scale": {
                "domain": ["ACT", "NSW", "NT", "QLD", "SA", "TAS", "VIC", "WA"],
                "range": ["#00f9c6", "#bc75d3", "#00d2ff", "#00a3ff", "#7270ff", "#878bf3", "#d169b9", "#00459f"]
              },
              "legend": {
                "title": "State (Click to select!)",
                "titleColor": "#286d86",
                  "labelColor": "#286d86"
              }
            },
            "opacity": {
              "condition": {
                "selection": "state_highlight",
                "value": 1
              },
              "value": 0.1
            }
          }
        },
        {
          "mark": "point",
          "encoding": {
            "x": {
              "field": "year",
              "type": "temporal",
              "axis": {
                "title": "Year"
              }
            },
            "y": {
              "field": "netflow",
              "type": "quantitative",
              "axis": {
                "title": "Netflow"
              }
            },
            "color": {
              "field": "state"
            },
            "opacity": {
              "condition": {
                "selection": "state_highlight",
                "value": 1
              },
              "value": 0.1
            },
            "tooltip": [
              {
                "title": "Insight",
                "field": "Insight",
                "type": "nominal"
              }
            ]
          }
        },
        {
          "data": {
            "values": [
              {
                "year": "2020-01-01",
                "text": "Covid Pandemic started.",
                "y": 200
              }
            ]
          },
          "layer": [
            {
              "mark": "rule",
              "encoding": {
                "x": {
                  "field": "year",
                  "type": "temporal",
                  "axis": {
                    "tickCount": "year",
                    "labelAngle": -45,
                    "titleColor": "#286d86"
                  }
                },
                "color": {
                  "value": "red"
                },
                "size": {
                  "value": 2
                }
              }
            },
            {
              "mark": {
                "type": "text",
                "dy": -40
              },
              "encoding": {
                "x": {
                  "field": "year",
                  "type": "temporal"
                },
                "y": {
                  "field": "y",
                  "type": "quantitative"
                },      "color": {"value": "#286d86"},
                "text": {
                  "field": "text",
                  "type": "nominal"
                }
                
              }
            }
          ]
        }
      ]
    }
  ]
}